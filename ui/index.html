<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Spotify Player</title>
    <title>Retro Spotify Player</title>
    <script>
        window.onSpotifyWebPlaybackSDKReady = (() => {
            const callbacks = [];
            const wrapper = () => callbacks.forEach(cb => cb());
            wrapper.subscribe = (cb) => callbacks.push(cb);
            return wrapper;
        })();
    </script>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <link rel="stylesheet" href="src/style.css">
</head>

<body>
    <div id="app-loading">
        <h1>Retro Spotify Player</h1>
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <div id="login-container" class="hidden">
        <h1>Retro Spotify Player</h1>
        <p>A pixelated music experience</p>
        <div id="login-actions">
            <button id="login-button" class="login-button">Login with Spotify</button>
        </div>
        <div id="login-loading" class="hidden">
            <div class="loading-spinner"></div>
            <p>Connecting to Spotify...</p>
        </div>
    </div>

    <div id="player-container" class="hidden">
        <div class="queue-column">
            <div class="queue-panel">
                <h2>Queue</h2>
                <div class="queue-controls">
                    <button id="resume-playback-button">RESUME</button>
                    <button id="refresh-queue-button">REFRESH</button>
                </div>
                <ul id="queue-list" class="track-list queue-list">
                    <li class="empty">Queue is empty.</li>
                </ul>
            </div>
        </div>
        <div class="main-screen">
            <div class="now-playing-panel">
                <div id="now-playing">
                    <img id="album-art" src="https://via.placeholder.com/150" alt="Album Art">
                    <div id="track-info">
                        <div id="track-name">Select a song</div>
                        <div id="artist-name">...</div>
                    </div>
                    <button id="like-button" class="like-button" aria-label="Like Song"></button>
                </div>
                <div id="controls">
                    <button id="prev-button">PREV</button>
                    <button id="play-button">PLAY</button>
                    <button id="next-button">NEXT</button>
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
                <div id="time-display" class="time-display">0:00 / 0:00</div>
                <div class="audio-controls">
                    <h2>Volume <span id="volume-percent" class="volume-percent">50%</span></h2>
                    <div class="volume-controls">
                        <button id="lyrics-button" aria-label="Lyrics" title="Toggle Lyrics">MIC</button>
                        <button id="volume-down" aria-label="Volume down">-</button>
                        <input type="range" id="volume-slider" min="0" max="100" value="50">
                        <button id="volume-up" aria-label="Volume up">+</button>
                    </div>
                </div>
            </div>

            <div id="lyrics-container" class="hidden">
                <div id="lyrics-loading" class="hidden">Loading lyrics...</div>
                <div id="lyrics-content"></div>
            </div>
            <div class="search-section">
                <div class="search-header-row">
                    <h2>Search Tracks</h2>
                    <button id="minimize-search-button" class="hidden" aria-label="Minimize Search">-</button>
                </div>
                <div class="search-controls">

                    <input type="text" id="search-input" placeholder="Search track or album...">
                    <button id="search-button">SEARCH</button>
                </div>
                <ul id="search-results" class="track-list"></ul>
            </div>
        </div>
        <div class="side-panel">
            <h2>Playlists</h2>

            <ul id="playlist-list">
                <!-- Playlists will be dynamically loaded here -->
            </ul>
        </div>
        <div id="playlist-details" class="playlist-details hidden">
            <div class="playlist-details-header">
                <div class="playlist-details-meta">
                    <img id="playlist-details-art" src="https://via.placeholder.com/120" alt="Playlist Art">
                    <div class="playlist-details-text">
                        <h2 id="playlist-details-name">Playlist</h2>
                        <div id="playlist-details-owner" class="playlist-details-owner"></div>
                    </div>
                </div>
                <button id="close-playlist-details" aria-label="Close playlist details">X</button>
            </div>
            <div class="playlist-details-controls">
                <button id="playlist-play-button">PLAY PLAYLIST</button>
            </div>
            <ul id="playlist-tracks" class="track-list"></ul>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
    <!-- Inline script removed, logic moved to main.js -->
    <script type="module">
        import { getAccessToken } from './src/spotifyToken.js';

        // Expose helper so calling spotifyToken() in the console returns the latest token.
        window.spotifyToken = async function spotifyToken(options = {}) {
            const result = await getAccessToken(options);
            if (result?.accessToken) {
                console.info('Spotify access token:', result.accessToken);
            }
            return result?.accessToken ?? null;
        };
    </script>
</body>

</html>